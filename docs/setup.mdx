---
sidebar_position: 1
---
import InstallationDoneScreenshot from '@site/static/img/1-installationDone.png';
import CloneDoneScreenshot from '@site/static/img/2-CloneDone.png';
import JumperImage from '@site/static/img/jumper-cable-connection.webp';
import AllImage from '@site/static/img/all-connections.webp';
import DeviceManagerImage from '@site/static/img/device-manager.png';
import SetSerialPortImage from '@site/static/img/set-serial-port.png';

# 使い方説明

このページは、メルカリShopsで販売中の自動化セット（[導入サポートあり](https://mercari-shops.com/products/FGZAmHY2fs6VrceEbdAfbj)・[なし](https://mercari-shops.com/products/hPPGH2Q9EN7mDTzpQpXsYd)）向けの説明書です。

## 0. 封入物の確認

以下の機材が含まれていることを確認します。

- Arduino Leonardo（1個、Poke-Controller用プログラム書き込み済み[^1]）
- USB-シリアル通信変換モジュール（1個+予備1個）
- HDMIキャプチャボード（1個）
- Micro USB ⇔ USBケーブル（1本）
- Type-C ⇔ USBケーブル（1本）
- ジャンパケーブル（オス-メス）（2本+予備）

[^1]: Arduino IDEでの書き込み作業は、発送前に完了しているので不要です。

内容物が不足している場合には、取引メッセージよりご連絡ください。


## 1. Poke-Controller Modifiedの導入

### 1-1. Poke-Controller Modified インストールスクリプトのダウンロード

以下のツイートのリンクをブラウザで開き、zipファイルをダウンロードします。

https://twitter.com/Rokkoku_I/status/1505534135670288385 [^2]

[^2]: 本スクリプトは、「[ろっこく](https://twitter.com/Rokkoku_I/)」さんが作成された、「Python環境構築からPoke-Controllerの導入、実行を代行してくれるbatファイル(v05)」です。

### 1-2. Poke-Controller Modified インストールスクリプトの実行


次に、ダウンロードしたzipファイルを [展開](https://support.microsoft.com/ja-jp/windows/8d28fa72-f2f9-712f-67df-f80cf89fd4e5#ID0ED-button) します。<br />

展開したら、作成されたフォルダを開き、`BatsForPokecon_v05` > `PokeController` 内の3つのバッチファイル

- 1_PokeConEnv.bat
- 2-2_ClonePokeConModified.bat
- 3-2_ExecutePokeConModified.bat

を上から順に実行します。（うまく行かない場合は、ウイルス対策ソフトが起動している場合、停止するとうまくいく場合があります。）

なお、`1_PokeConEnv.bat` は5〜30分程度（PCや回線のの速度によって異なります）時間がかかります。<br />
完了すると、「Poke-Controller-Modifiedの環境構築が完了しました」と表示されます。

<img src={InstallationDoneScreenshot} alt="installation done screenshot" width="50%" />

`2-2_ClonePokeConModified.bat` は、1分程度で完了します。<br />

<img src={CloneDoneScreenshot} alt="clone done screenshot" width="50%" />

`3-2_ExecutePokeConModified.bat`を実行すると、Poke-Controller Modifiedが起動します。

## 2. 機器の接続

一旦PC画面から離れ、機材を取り出して以下を順に接続します。

1. 「USB-シリアル変換モジュール[^3]」と「Arduino Leonardo[^4]」を、ジャンパケーブル [^5] 2本で接続します。<br />
`GND - GND`, `TXD - RX←0` を接続し、以下の写真のようにしてください。

[^3]:小さいほうの基板
[^4]:大きいほうの基板
[^5]: ジャンパケーブルは、1本ずつちぎってご利用ください。予備をたくさん入れていますが、必要なのは2本だけです。

<img src={JumperImage} alt="example of jumper cable connections" width="50%" />

2. 「USB-シリアル変換モジュール」とPCを、同梱のType-Cケーブルで接続します。
    - 上手く接続できていると、変換モジュールに青いライトがつきます。<br />ライトがつかない場合は、もう1つのモジュールを開封してご利用ください。[^6]

[^6]:20個に1つ程度不良品があります。2つ封入しておりますが、万が一両方とも使用できない場合はご連絡ください。

3. 「Arduino Leonardo」と「ニンテンドーSwitchに接続したDock」を、Micro USBケーブルで接続します。
4. キャプチャボードをPCのUSBポートに接続します。
5. キャプチャボードと「ニンテンドーSwitchに接続したDock」を、HDMIケーブル[^7]で接続します。

[^7]:HDMIケーブルとは、Switchとテレビ等を接続するケーブルです。<br />
テレビ等から抜いて、テレビ等に刺さっていた側の端子をキャプチャボードに刺してください。

ここまで完了すると、以下の図のような配線となります。

<img src={AllImage} alt="example of all connections" width="50%" />

## 3. 利用したい自動化プログラムの追加

Poke-Controller ModifiedのPythonCommandsフォルダや、その2つ上の階層のTemplatesフォルダにファイルを配置します。<br />
（PythonCommandsフォルダは、Poke-Controller Modifiedを起動して、画面右下のコマンド選択欄のフォルダアイコンをクリックすると開けます）

詳しくは、利用したい自動化プログラムに付属の説明をご覧ください。

自動化プログラムは、インターネット上で公開されているもの利用するか、ご自身で作成していただく必要があります。<br />
[こちらのページ](/docs/programs/) に、各種のおすすめプログラムを掲載しております。

## 4. Poke-Controller Modifiedの起動と実行

1. 既にPoke-Controller Modifiedが開いている場合は、一旦閉じます。
2. `3-2_ExecutePokeConModified.bat` を実行し、Poke-Controller Modifiedを起動します。
3. 画面上部の映像キャプチャデバイスの選択欄から、「USB Video」を選択し、「Reload Camera」をクリックします。
4. 「デバイスマネージャー」を開き（[開き方](https://askpc.panasonic.co.jp/beginner/guide/ten07/7013.html)）、「ポート（COMとLPT）」から「USB-SERIAL CH340」と書いてあるものを探してポート番号を見つけます。<br />
    例えば、「USB-SERIAL CH340（COM5）」と書いてある場合、ポート番号は「5」です。<br />
    そして、見つけたポート番号をPoke-Controller Modifiedの画面左下のポート設定欄に設定し、「Reload Port」ボタンをクリックします。[^8]
    <img src={DeviceManagerImage} alt="device manager" style={{height: "200px", marginRight: "16px"}} />
    <img src={SetSerialPortImage} alt="set serial port in poke-controller modified" style={{height: "200px"}} />
5. 画面右下のコマンド選択欄から使用したいコマンドを選択し、Startボタンをクリックします。

[^8]:見つからない場合は、デバイスマネージャー上部のメニューバーから、「管理」→「ハードウェア変更のスキャン」をクリックしてください。

これで、自動化プログラムが実行されます。<br />
なお、自動操作時には他の有線・無線のコントローラは接続を解除してご利用ください。

上手く動かないときは、画面左下の「Controller」ボタンを押して「操作ウインドウ」を出し、以下の点をご確認ください。

1. 「操作ウインドウ」でボタン操作をしても、「シリアル変換モジュール」のLED（`D1`）が緑色に点滅しないとき<br />
    シリアル通信のポート設定が上手くいっていません。<br />
    デバイスマネージャー上部のメニューバーから、「管理」→「ハードウェア変更のスキャン」をクリックし、ポート番号を再度確認してください。<br />
    ポート番号が変わった場合は、Poke-Controller側のポート設定も変更してください。
2. 「操作ウインドウ」でボタン操作をすると、「シリアル変換モジュール」ではLED（`D1`）が緑色に点滅するが、「Arduino Leonardo」ではLED（`TX`）がオレンジ色に点滅しないとき<br />
    ジャンパケーブルまたはUSBケーブルの配線がうまくいっていません。<br />
    - ジャンパケーブルは、`GND - GND`, `TXD - RX←0` で正しく接続していることを確認してください。
    - Arduino Leonardoに接続したMicro USBケーブルは、Dock側面のUSBポートに接続してください。
3. 「操作ウインドウ」でボタン操作をすると、「シリアル変換モジュール」ではLED（`D1`）が緑色に点滅し、「Arduino Leonardo」でもLED（`TX`）がオレンジ色に点滅するが、Switchに操作が反映されないとき<br />
    Switchが、Poke-Controller Modified以外のコントローラを、最優先のコントローラとして認識しています。<br />
    以下の手順で、コントローラを再接続してください。
    1. Swtichを一度Dockから取り出す
    2. 「HOMEボタン」を押す→画面下部の「コントローラ」の丸いアイコンを選択→「持ちかた/順番を変える」を選択
    3. SwitchをDockに戻す
    4. 「操作ウインドウ」から数回キーを入力し、コントローラが認識されるか確認する[^9]

[^9]:LRを同時押ししなくても、Aボタンなどを数回押すだけで認識されます。
